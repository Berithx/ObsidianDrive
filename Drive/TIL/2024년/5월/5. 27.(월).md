```table-of-contents
title: 
style: nestedList # TOC style (nestedList|inlineFirstLevel)
minLevel: 0 # Include headings from the specified level
maxLevel: 0 # Include headings up to the specified level
includeLinks: true # Make headings clickable
debugInConsole: false # Print debug info in Obsidian console
```

# 1. JPA CORE
## ■ 영속성 컨텍스트의 기

### - 1차 캐시
- 영속성 컨텍스트는 내부적으로 캐시 저장소를 가지고 있다.
	- Entity 객체를 저장하면 1차 캐시(캐시 저장소)에 저장된다 생각해도 된다.
	- 캐시 저장소는 Map 자료구조 형태로 되어있다.
		- Key : 기본 키(PK), 식별자 값을 저장한다.
		- Value : 해당 Entity 객체를 저장한다.
		- 영속성 컨텍스는 캐시 저장소 Key에 저장된 식별자 값을 사용하여 Entity 객체를 구분하고 관리한다.

- **Entity 저장**
  ``` java
	@Test
	@DisplayName("1차 캐시 : Entity 저장")
	void test1() {
    EntityTransaction et = em.getTransaction();

	    et.begin();

	    try {
	        Entity entity = new Entity();
	        entity.setId(1L);
	        entity.setName("User");
	        entity.setContents("1차 캐시 Entity 저장");

	        em.persist(entity);

	        et.commit();

	    } catch (Exception ex) {
	        ex.printStackTrace();
	        et.rollback();
	    } finally {
	        em.close();
	    }

	    emf.close();
	}
	```
	- `em.persist(entity);` 메서드가 호출되면 Entity 객체를 캐시 저장소에 저장한다.
	- 디버깅을 통해 em > persistenceContext > entitiesByKey를 확인하면 Key-Value 형태로 저장된 것을 확인할 수 있다.
	  
- **Entity 조회**
	1.  캐시 저장소에 조회하려는 ID가 존재하지 않는 경우
	  ```
		```
	    - 캐시 저장소 조회
	    - DB SELECT 조회 후 캐시 저장소에 저장
	    - `em.find(Entity.class, 1);`  호출 시 캐시 저장소를 확인했을 때 값이 없을 경우 DB에 DB





[[Templates]]
